import t from"debug";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/net-http-server@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/fs-read-file@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-open-url@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-noop@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/buffer-ctor@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/buffer-from-string@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-next-tick@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-buffer@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";function h(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})})),e}var v="/home/runner/work/net-disposable-http-server/net-disposable-http-server/lib";function j(t,e){for(var r=0,n=t.length-1;n>=0;n--){var s=t[n];"."===s?t.splice(n,1):".."===s?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}var g=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,b=function(t){return g.exec(t).slice(1)};function x(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var n=r>=0?arguments[r]:"/";if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(t=n+"/"+t,e="/"===n.charAt(0))}return(e?"/":"")+(t=j(E(t.split("/"),(function(t){return!!t})),!e).join("/"))||"."}function y(t){var e=w(t),r="/"===L(t,-1);return(t=j(E(t.split("/"),(function(t){return!!t})),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t}function w(t){return"/"===t.charAt(0)}function S(){var t=Array.prototype.slice.call(arguments,0);return y(E(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))}function T(t,e){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=x(t).substr(1),e=x(e).substr(1);for(var n=r(t.split("/")),s=r(e.split("/")),i=Math.min(n.length,s.length),o=i,a=0;a<i;a++)if(n[a]!==s[a]){o=a;break}var l=[];for(a=o;a<n.length;a++)l.push("..");return(l=l.concat(s.slice(o))).join("/")}function C(t){var e=b(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."}function O(t,e){var r=b(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r}function k(t){return b(t)[3]}var A={extname:k,basename:O,dirname:C,sep:"/",delimiter:":",relative:T,join:S,isAbsolute:w,normalize:y,resolve:x};function E(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r}var L="b"==="ab".substr(-1)?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return e<0&&(e=t.length+e),t.substr(e,r)},_=h(Object.freeze({__proto__:null,resolve:x,normalize:y,isAbsolute:w,join:S,relative:T,sep:"/",delimiter:":",dirname:C,basename:O,extname:k,default:A})),H=c,P=d.isPrimitive,M=s.isPrimitive,z=m,D=f;var R=function(t,e){return z(e)?!D(e,"html")||(t.html=e.html,H(t.html)||M(t.html))?!D(e,"javascript")||(t.javascript=e.javascript,H(t.javascript)||M(t.javascript))?D(e,"open")&&(t.open=e.open,!P(t.open))?new TypeError("invalid option. `open` option must be a primitive boolean. Option: `"+t.open+"`."):null:new TypeError("invalid option. `javascript` option must be either a `buffer` or a primitive string. Option: `"+t.javascript+"`."):new TypeError("invalid option. `html` option must be either a `buffer` or a primitive string. Option: `"+t.html+"`."):new TypeError("invalid argument. Options argument must be an object. Value: `"+e+"`.")},V=f;var q=function(t){var e={};return V(t,"port")&&(e.port=t.port),V(t,"maxport")&&(e.maxport=t.maxport),V(t,"hostname")&&(e.hostname=t.hostname),V(t,"address")&&(e.address=t.address),e};var F=function(){return{}},J=_,N=t,$=e,B=r,G=n.sync,I=s.isPrimitive,K=i,Q=o,U=a,W=l,X=u,Y=p,Z=R,tt=q,et=F,rt=N("disposable-http-server");var nt=function(t){var e,r,n,s,i,o,a,l,u;if(l={},arguments.length>1){if(!K(o=arguments[1]))throw new TypeError("invalid argument. Callback argument must be a function. Value: `"+o+"`.")}else o=U;if(u=Z(l,t))throw u;function p(t,e){var r;if(t)throw t;rt("Server started."),(n=e).on("connection",c),n.once("close",x),l.open&&(r=n.address(),Q("http://"+r.address+":"+r.port)),o(null,n)}function c(t){var r=t.remoteAddress+":"+t.remotePort;rt("Received a socket connection: %s.",r),e[r]=t,t.on("close",(function(){rt("Socket connection closed: %s.",r),delete e[r]}))}function d(t,e){if(rt("Received a request for %s",t.url),r)return f(t,e);if("/bundle.js"===t.url)return Y(n(j)),e.once("finish",g);if("/"!==t.url&&"/index.html"!==t.url)return m(t,e);function n(r){return function(){r(t,e)}}Y(n(h)),l.javascript||e.once("finish",g)}function m(t,e){rt("Sending 404 response..."),e.statusCode=404,e.end()}function f(t,e){rt("Sending 503 response..."),e.statusCode=503,e.end()}function h(t,e){rt("Sending HTML..."),e.statusCode=200,e.setHeader("Content-Type","text/html"),e.setHeader("Content-Length",W.byteLength(l.html.toString())),e.end(l.html)}function j(t,e){rt("Sending JavaScript..."),e.statusCode=200,e.setHeader("Content-Type","text/javascript"),e.setHeader("Content-Length",W.byteLength(l.javascript.toString())),e.end(l.javascript)}function g(){rt("Finished serving content."),r=!0,rt("Closing the server..."),n.close(),setTimeout(b,5e3)}function b(){var t,r;for(rt("Destroying all connections..."),t=$(e),r=0;r<t.length;r++)rt("Destroying connection %s...",t[r]),e[t[r]].destroy()}function x(){rt("Server closed.")}l.html&&I(l.html)&&(l.html=X(l.html)),l.javascript&&I(l.javascript)&&(l.javascript=X(l.javascript)),s=tt(t),rt("Serving provided content."),l.html||(rt("No HTML content provided."),rt("Loading a boilerplate HTML page..."),i=J.resolve(v,"../static/index.html"),l.html=G(i)),a=B(s,d),rt("Starting server..."),a(p),e=et()},st=nt;export{st as default};
